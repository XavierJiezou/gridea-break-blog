{"posts":[{"title":"【Python】为什么多线程并行不快反慢？","content":"项目场景 这里有个证件照换底的需求：将图像的透明底色换为红色背景。其逻辑是用一个嵌套的 for 循环分别遍历图像的行和列，判断每一个位置的像素点是否是透明的，如果是，换成红色背景；如果不是，则不做任何修改。但目前的问题是速度有点慢，需要做并行加速。我们用 Python 自带的多线程池进行优化，优化程序的代码如下： &quot;&quot;&quot;安装依赖模块 pip install numpy opencv-python tqdm &quot;&quot;&quot; import time import numpy as np from cv2 import cv2 from tqdm import tqdm import concurrent.futures as cf class ChangeBackgroundColor(): &quot;&quot;&quot;修改图片背景的类（默认将透明背景修改为红色背景） Args: root (str): 输入图片的路径 &quot;&quot;&quot; def __init__(self, root: str): &quot;&quot;&quot;类的初始化函数 Args: root (str): 输入图片的路径 &quot;&quot;&quot; self.image_original = cv2.imread(root, cv2.IMREAD_UNCHANGED) self.rows, self.cols, _ = self.image_original.shape self.serial() self.parallel() def serial(self): &quot;&quot;&quot;串行程序 &quot;&quot;&quot; t1 = time.time() for i in tqdm(range(self.rows), desc='Serial-Time'): for j in range(self.cols): if (self.image_original[i][j] == np.zeros(4)).all(): self.image_original[i][j] = np.array([0, 0, 255, 255]) else: pass t2 = time.time() cv2.imwrite('./red.png', self.image_original) def __temp__(self, i, pbar): &quot;&quot;&quot;并行程序依赖的临时函数 Args: i (int): 图片矩阵的行索引 pbar (tqdm()): tqdm的进度条实例 &quot;&quot;&quot; for j in range(self.cols): if (self.image_original[i][j] == np.zeros(4)).all(): self.image_original[i][j] = np.array([0, 0, 255, 255]) # 图片背景修改为红色 | 注意OPENCV的通道是BGR else: pass pbar.update() def parallel(self): &quot;&quot;&quot;并行程序 &quot;&quot;&quot; t1 = time.time() with tqdm(total=self.rows, desc='Parallel-Time') as pbar: with cf.ThreadPoolExecutor() as tp: for i in range(self.rows): tp.submit(self.__temp__, i, pbar) t2 = time.time() cv2.imwrite('./red.png', self.image_original) if __name__ == '__main__': ChangeBackgroundColor('./original.png') 测试样例 样例输入 样例输出 问题描述 代码命名已经做了多线程并行优化，但速度不但没有提升，反而下降了？？ 串行在我自己电脑上测试的是 8s，并行测试的是 23s。 解决方案 会不会是 Python 全局解释锁（GIL）的问题？ （待解决……） ","link":"https://xavierjiezou.github.io/post/python-wei-shi-me-duo-xian-cheng-bing-xing-bu-kuai-fan-man/"},{"title":"【LaTex】公式编辑常用语法（持续更新……）","content":"语法 描述 语法 预览 点乘 a \\cdot b a⋅ba \\cdot ba⋅b 叉乘 a \\times b a×ba \\times ba×b 点除 a \\div b a÷ba \\div ba÷b 分数 \\frac {a}{b} ab\\frac {a}{b}ba​ 上标 a^{b} aba^{b}ab 下标 a_{b} aba_{b}ab​ 求和 \\sum_{n=1}^{N}a_{n} ∑n=1Nan\\sum_{n=1}^{N}a_{n}∑n=1N​an​ 参考 https://oeis.org/wiki/List_of_LaTeX_mathematical_symbols ","link":"https://xavierjiezou.github.io/post/latex-gong-shi-bian-ji-chang-yong-yu-fa-chi-xu-geng-xin/"},{"title":"Hello Gridea","content":"👏 欢迎使用 Gridea ！ ✍️ Gridea 一个静态博客写作客户端。你可以用它来记录你的生活、心情、知识、笔记、创意... ... Github Gridea 主页 示例网站 特性👇 📝 你可以使用最酷的 Markdown 语法，进行快速创作 🌉 你可以给文章配上精美的封面图和在文章任意位置插入图片 🏷️ 你可以对文章进行标签分组 📋 你可以自定义菜单，甚至可以创建外部链接菜单 💻 你可以在 Windows，MacOS 或 Linux 设备上使用此客户端 🌎 你可以使用 𝖦𝗂𝗍𝗁𝗎𝖻 𝖯𝖺𝗀𝖾𝗌 或 Coding Pages 向世界展示，未来将支持更多平台 💬 你可以进行简单的配置，接入 Gitalk 或 DisqusJS 评论系统 🇬🇧 你可以使用中文简体或英语 🌁 你可以任意使用应用内默认主题或任意第三方主题，强大的主题自定义能力 🖥 你可以自定义源文件夹，利用 OneDrive、百度网盘、iCloud、Dropbox 等进行多设备同步 🌱 当然 Gridea 还很年轻，有很多不足，但请相信，它会不停向前 🏃 未来，它一定会成为你离不开的伙伴 尽情发挥你的才华吧！ 😘 Enjoy~ ","link":"https://xavierjiezou.github.io/post/hello-gridea/"}]}