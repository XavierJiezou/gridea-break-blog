{"posts":[{"fileName":"python-wei-shi-me-duo-xian-cheng-bing-xing-bu-kuai-fan-man","abstract":"<h1 id=\"项目场景\">项目场景</h1>\n<p>这里有个证件照换底的需求：将图像的透明底色换为红色背景。其逻辑是用一个嵌套的 for 循环分别遍历图像的行和列，判断每一个位置的像素点是否是透明的，如果是，换成红色背景；如果不是，则不做任何修改。但目前的问题是速度有点慢，需要做并行加速。我们用 Python 自带的多线程池进行优化，优化程序的代码如下：</p>\n<pre><code class=\"language-python\">&quot;&quot;&quot;安装依赖模块\npip install numpy opencv-python tqdm\n&quot;&quot;&quot;\nimport time\nimport numpy as np\nfrom cv2 import cv2\nfrom tqdm import tqdm\nimport concurrent.futures as cf\n\n\nclass ChangeBackgroundColor():\n    &quot;&quot;&quot;修改图片背景的类（默认将透明背景修改为红色背景）\n\n    Args:\n        root (str): 输入图片的路径\n    &quot;&quot;&quot;\n    def __init__(self, root: str):\n        &quot;&quot;&quot;类的初始化函数\n\n        Args:\n            root (str): 输入图片的路径\n        &quot;&quot;&quot;\n        self.image_original = cv2.imread(root, cv2.IMREAD_UNCHANGED)\n        self.rows, self.cols, _ = self.image_original.shape\n        self.serial()\n        self.parallel()\n\n    def serial(self):\n        &quot;&quot;&quot;串行程序\n        &quot;&quot;&quot;\n        t1 = time.time()\n        for i in tqdm(range(self.rows), desc='Serial-Time'):\n            for j in range(self.cols):\n                if (self.image_original[i][j] == np.zeros(4)).all():\n                    self.image_original[i][j] = np.array([0, 0, 255, 255])\n                else:\n                    pass\n        t2 = time.time()\n        cv2.imwrite('./red.png', self.image_original)\n\n    def __temp__(self, i, pbar):\n        &quot;&quot;&quot;并行程序依赖的临时函数\n\n        Args:\n            i (int): 图片矩阵的行索引\n            pbar (tqdm()): tqdm的进度条实例\n        &quot;&quot;&quot;\n        for j in range(self.cols):\n            if (self.image_original[i][j] == np.zeros(4)).all():\n                self.image_original[i][j] = np.array([0, 0, 255, 255]) # 图片背景修改为红色 | 注意OPENCV的通道是BGR\n            else:\n                pass\n        pbar.update()\n\n    def parallel(self):\n        &quot;&quot;&quot;并行程序\n        &quot;&quot;&quot;\n        t1 = time.time()\n        with tqdm(total=self.rows, desc='Parallel-Time') as pbar:\n            with cf.ThreadPoolExecutor() as tp:\n                for i in range(self.rows):\n                    tp.submit(self.__temp__, i, pbar)\n        t2 = time.time()\n        cv2.imwrite('./red.png', self.image_original)\n\n\nif __name__ == '__main__':\n    ChangeBackgroundColor('./original.png')\n</code></pre>\n<h1 id=\"测试样例\">测试样例</h1>\n<h2 id=\"样例输入\">样例输入</h2>\n<figure data-type=\"image\" tabindex=\"1\"><img src=\"https://img-blog.csdnimg.cn/bdaf7a8578dd443b90e973dcd72a6573.png?x-oss-process=imag,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWGF2aWVyIEppZXpvdQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center\" alt=\"在这里插入图片描述\" loading=\"lazy\"></figure>\n<h2 id=\"样例输出\">样例输出</h2>\n<figure data-type=\"image\" tabindex=\"2\"><img src=\"https://img-blog.csdnimg.cn/5f425e8e29444c5bbf9454dd49aa3807.png?x-oss-process=image,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWGF2aWVyIEppZXpvdQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center\" alt=\"在这里插入图片描述\" loading=\"lazy\"></figure>\n<h1 id=\"问题描述\">问题描述</h1>\n<p>代码命名已经做了多线程并行优化，但速度不但没有提升，反而下降了？？</p>\n<p><mark>串行在我自己电脑上测试的是8s，并行测试的是23s。</mark></p>\n<h1 id=\"解决方案\">解决方案</h1>\n<p>会不会是 Python 全局解释锁（GIL）的问题？</p>\n<p><mark>（待解决……）</mark></p>\n","description":"项目场景 这里有个证件照换底的需求：将图像的透明底色换为红色背景。其逻辑是用一个嵌套的 for 循环分别遍历图像的行和列，判断每一个位置的像素点是否是透明的，如果是，换成红色背景；如果不是，则不做任何修改。但目前的问题是速度有点慢，需要做并...","title":"【Python】为什么多线程并行不快反慢？","tags":[{"name":"python","slug":"2u-SDzgjO","used":true,"link":"https://xavierjiezou.github.io/tag/2u-SDzgjO/"},{"name":"多线程","slug":"6BJ_senDvh","used":true,"link":"https://xavierjiezou.github.io/tag/6BJ_senDvh/"}],"feature":"https://xavierjiezou.github.io/post-images/python-wei-shi-me-duo-xian-cheng-bing-xing-bu-kuai-fan-man.png","link":"https://xavierjiezou.github.io/post/python-wei-shi-me-duo-xian-cheng-bing-xing-bu-kuai-fan-man/","stats":{"text":"3 min read","time":152000,"words":551,"minutes":3},"isTop":false,"toc":"<ul class=\"markdownIt-TOC\">\n<li><a href=\"#%E9%A1%B9%E7%9B%AE%E5%9C%BA%E6%99%AF\">项目场景</a></li>\n<li><a href=\"#%E6%B5%8B%E8%AF%95%E6%A0%B7%E4%BE%8B\">测试样例</a>\n<ul>\n<li><a href=\"#%E6%A0%B7%E4%BE%8B%E8%BE%93%E5%85%A5\">样例输入</a></li>\n<li><a href=\"#%E6%A0%B7%E4%BE%8B%E8%BE%93%E5%87%BA\">样例输出</a></li>\n</ul>\n</li>\n<li><a href=\"#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0\">问题描述</a></li>\n<li><a href=\"#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\">解决方案</a></li>\n</ul>\n","date":"2022-01-05 01:34:49","dateFormat":"2022-01-05"},{"fileName":"hello-gridea","abstract":"<p>👏  欢迎使用 <strong>Gridea</strong> ！<br>\n✍️  <strong>Gridea</strong> 一个静态博客写作客户端。你可以用它来记录你的生活、心情、知识、笔记、创意... ...</p>\n","description":"👏 欢迎使用 Gridea ！ ✍️ Gridea 一个静态博客写作客户端。你可以用它来记录你的生活、心情、知识、笔记、创意... ... Github Gridea 主页 示例网站 特性👇 📝 你可以使用最酷的 Markdo...","title":"Hello Gridea","tags":[{"name":"Gridea","slug":"2QJsGIJaG","used":true,"link":"https://xavierjiezou.github.io/tag/2QJsGIJaG/"}],"feature":"https://xavierjiezou.github.io/post-images/hello-gridea.png","link":"https://xavierjiezou.github.io/post/hello-gridea/","stats":{"text":"2 min read","time":62000,"words":298,"minutes":2},"isTop":false,"toc":"<ul class=\"markdownIt-TOC\">\n<li>\n<ul>\n<li><a href=\"#%E7%89%B9%E6%80%A7\">特性👇</a></li>\n</ul>\n</li>\n</ul>\n","date":"2018-12-12 00:00:00","dateFormat":"2018-12-12"}],"tags":[{"name":"python","slug":"2u-SDzgjO","used":true,"link":"https://xavierjiezou.github.io/tag/2u-SDzgjO/","count":1},{"name":"多线程","slug":"6BJ_senDvh","used":true,"link":"https://xavierjiezou.github.io/tag/6BJ_senDvh/","count":1},{"name":"Gridea","slug":"2QJsGIJaG","used":true,"link":"https://xavierjiezou.github.io/tag/2QJsGIJaG/","count":1}],"menus":[{"link":"/","name":"首页","openType":"Internal"},{"link":"/archives","name":"归档","openType":"Internal"},{"link":"/tags","name":"标签","openType":"Internal"},{"link":"/post/about","name":"关于","openType":"Internal"}],"themeConfig":{"themeName":"gridea-theme-pure","postPageSize":10,"archivesPageSize":50,"siteName":"XavierJiezou","siteDescription":"温故而知新","footerInfo":"Powered by <a href=\"https://github.com/getgridea/gridea\" target=\"_blank\">Gridea</a>","showFeatureImage":true,"domain":"https://xavierjiezou.github.io","postUrlFormat":"SLUG","tagUrlFormat":"SHORT_ID","dateFormat":"YYYY-MM-DD","feedFullText":true,"feedCount":10,"archivesPath":"archives","postPath":"post","tagPath":"tag"},"customConfig":{"skin":"black"},"utils":{"now":1641320059417}}
